{% extends 'marketplace/base.html' %}

{% block content %}
<section class="max-w-[1600px] mx-auto px-6 sm:px-8 py-8">
    <div class="flex gap-8">
        <!-- Â∑¶‰æßÁ≠õÈÄâÊ†è - 3ÂàóÁΩëÊ†º‰∏≠ÁöÑ1Âàó -->
        <aside class="w-80 flex-shrink-0">
            <div class="sticky top-24 space-y-8">
                <!-- ÊêúÁ¥¢Ê°Ü - ÊúÄ‰∏äÈù¢ -->
                <div>
                    <form method="get">
                        <input type="hidden" name="major" value="{{ major_filter }}">
                        <input type="hidden" name="category" value="{{ category_filter }}">
                        <input type="text" name="search" value="{{ search_query }}" placeholder="Search" class="w-full px-4 py-3 border rounded-xl focus:outline-none transition text-base" style="border-color: var(--light-gray);" onfocus="this.style.borderColor='var(--primary-orange)'">
                    </form>
                </div>

                <!-- MajorÁ≠õÈÄâ -->
                <div>
                    <h3 class="font-semibold mb-4 text-base" style="color: var(--primary-green);">Major</h3>
                    <form method="get">
                        <input type="hidden" name="search" value="{{ search_query }}">
                        <input type="hidden" name="category" value="{{ category_filter }}">
                        <div class="space-y-2">
                            <label class="flex items-center cursor-pointer p-2 rounded-lg transition hover:bg-gray-50">
                                <input type="radio" name="major" value="" {% if not major_filter %}checked{% endif %} onchange="this.form.submit()" class="mr-3">
                                <span class="text-sm">All</span>
                            </label>
                            {% for value, label in majors %}
                            <label class="flex items-center cursor-pointer p-2 rounded-lg transition hover:bg-gray-50">
                                <input type="radio" name="major" value="{{ value }}" {% if major_filter == value %}checked{% endif %} onchange="this.form.submit()" class="mr-3">
                                <span class="text-sm">{{ label }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </form>
                </div>

                <!-- CategoryÁ≠õÈÄâ -->
                <div>
                    <h3 class="font-semibold mb-4 text-base" style="color: var(--primary-green);">Category</h3>
                    <form method="get">
                        <input type="hidden" name="search" value="{{ search_query }}">
                        <input type="hidden" name="major" value="{{ major_filter }}">
                        <div class="space-y-2">
                            <label class="flex items-center cursor-pointer p-2 rounded-lg transition hover:bg-gray-50">
                                <input type="radio" name="category" value="" {% if not category_filter %}checked{% endif %} onchange="this.form.submit()" class="mr-3">
                                <span class="text-sm">All</span>
                            </label>
                            {% for value, label in categories %}
                            <label class="flex items-center cursor-pointer p-2 rounded-lg transition hover:bg-gray-50">
                                <input type="radio" name="category" value="{{ value }}" {% if category_filter == value %}checked{% endif %} onchange="this.form.submit()" class="mr-3">
                                <span class="text-sm">{{ label }}</span>
                            </label>
                            {% endfor %}
                        </div>
                    </form>
                </div>
            </div>
        </aside>

        <!-- Âè≥‰æßÂïÜÂìÅÂå∫Âüü -->
        <main class="flex-1">
            <!-- Ê†áÈ¢òÂå∫Âüü - Âä®ÊÄÅÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÁ≠õÈÄâ -->
            <div class="flex justify-between items-baseline mb-10">
                <h1 class="text-5xl font-light" style="color: var(--primary-green);">{{ selected_title }}</h1>
                <span class="text-lg" style="color: var(--dark-gray);">{{ items.count }} items</span>
            </div>

            <!-- ÂïÜÂìÅÁΩëÊ†º - 3Âàó -->
            <div class="grid grid-cols-3 gap-8">
                {% for item in items %}
                <a href="{% url 'marketplace:item_detail' item.id %}" class="group block">
                    <!-- ÂïÜÂìÅÂõæÁâá -->
                    <div class="overflow-hidden mb-4 bg-gray-50">
                        {% if item.images.first %}
                            <img src="{{ item.images.first.image.url }}" alt="{{ item.name }}" class="w-full aspect-square object-cover transition-transform duration-300 group-hover:scale-105">
                        {% else %}
                            <div class="w-full aspect-square flex items-center justify-center" style="background-color: var(--light-gray);">
                                <span class="text-6xl">üé®</span>
                            </div>
                        {% endif %}
                    </div>

                    <!-- ÂïÜÂìÅ‰ø°ÊÅØ -->
                    <h3 class="font-normal mb-2 text-base leading-snug group-hover:opacity-70 transition" style="color: var(--text-black);">{{ item.name }}</h3>
                    <p class="text-lg font-semibold" style="color: var(--primary-orange);">${{ item.price }}</p>

                    <!-- Tags -->
                    {% if item.category or item.major %}
                    <div class="flex flex-wrap gap-1.5 mt-2">
                        {% if item.major %}
                        <span class="px-2 py-0.5 rounded text-xs tag">{{ item.get_major_display }}</span>
                        {% endif %}
                        {% if item.category %}
                        <span class="px-2 py-0.5 rounded text-xs tag">{{ item.get_category_display }}</span>
                        {% endif %}
                    </div>
                    {% endif %}
                </a>
                {% empty %}
                <div class="col-span-3 text-center py-20">
                    <p class="text-xl" style="color: var(--dark-gray);">No items found.</p>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>
</section>

<style>
/* ÂèñÊ∂àÊâÄÊúâÂõæÁâáÂúÜËßí */
img {
    border-radius: 0 !important;
}
</style>
{% endblock %}