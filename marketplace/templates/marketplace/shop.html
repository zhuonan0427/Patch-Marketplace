{% extends 'marketplace/base.html' %}

{% block title %}Shop - Patch!{% endblock %}

{% block content %}
<div class="max-w-[1600px] mx-auto px-8 py-12">
    <div class="flex gap-12">
        <!-- å·¦ä¾§å›ºå®šç­›é€‰æ  -->
        <aside class="w-64 flex-shrink-0 sticky top-8 self-start">
            <form method="get" id="filterForm">
                <!-- All Items æ ‡é¢˜ -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold mb-1" style="color: var(--primary-orange);">
                        All <sup class="text-sm">{{ items|length }}</sup>
                    </h2>
                </div>

                <!-- Major ç­›é€‰ -->
                <div class="mb-8">
                    <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: var(--text-black);">Major</h3>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="major" value="" {% if not major_filter %}checked{% endif %}
                                   class="mr-3 accent-orange-500" onchange="this.form.submit()">
                            <span class="text-base group-hover:opacity-70" style="color: var(--text-black);">All</span>
                        </label>
                        {% for value, label in majors %}
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="major" value="{{ value }}" {% if major_filter == value %}checked{% endif %}
                                   class="mr-3 accent-orange-500" onchange="this.form.submit()">
                            <span class="text-base group-hover:opacity-70" style="color: var(--text-black);">{{ label }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- Category ç­›é€‰ -->
                <div class="mb-8">
                    <h3 class="text-sm font-semibold mb-3 uppercase tracking-wide" style="color: var(--text-black);">Category</h3>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="category" value="" {% if not category_filter %}checked{% endif %}
                                   class="mr-3 accent-orange-500" onchange="this.form.submit()">
                            <span class="text-base group-hover:opacity-70" style="color: var(--text-black);">All</span>
                        </label>
                        {% for value, label in categories %}
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="category" value="{{ value }}" {% if category_filter == value %}checked{% endif %}
                                   class="mr-3 accent-orange-500" onchange="this.form.submit()">
                            <span class="text-base group-hover:opacity-70" style="color: var(--text-black);">{{ label }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <!-- æœç´¢æ¡† -->
                <div class="mb-8">
                    <input type="text" name="search" value="{{ search_query }}"
                           placeholder="Search items..."
                           class="w-full px-4 py-2 border rounded-lg text-sm"
                           style="border-color: var(--light-gray);">
                </div>

                <!-- Clear æŒ‰é’® -->
                {% if search_query or major_filter or category_filter %}
                <a href="{% url 'marketplace:shop' %}"
                   class="block text-center px-4 py-2 rounded-lg text-sm hover:opacity-70 transition"
                   style="color: var(--primary-orange); border: 1px solid var(--primary-orange);">
                    Clear All Filters
                </a>
                {% endif %}
            </form>
        </aside>

        <!-- å³ä¾§å•†å“ç½‘æ ¼ -->
        <main class="flex-1">
            {% if items %}
            <div class="grid grid-cols-3 gap-8">
                {% for item in items %}
                <a href="{% url 'marketplace:item_detail' item.id %}" class="group block">
                    <!-- å•†å“å›¾ç‰‡ -->
                    <div class="aspect-square bg-gray-50 rounded-2xl overflow-hidden mb-4 relative">
                        {% if item.images.first %}
                            <img src="{{ item.images.first.image.url }}"
                                 alt="{{ item.name }}"
                                 class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center"
                                 style="background-color: var(--light-gray);">
                                <span class="text-6xl opacity-30">ðŸŽ¨</span>
                            </div>
                        {% endif %}
                    </div>

                    <!-- å•†å“ä¿¡æ¯ -->
                    <div class="px-1">
                        <h3 class="font-medium text-base mb-1 truncate group-hover:opacity-70 transition"
                            style="color: var(--text-black);">
                            {{ item.name }}
                        </h3>
                        <p class="text-lg font-semibold" style="color: var(--primary-orange);">
                            ${{ item.price }}
                        </p>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <!-- ç©ºçŠ¶æ€ -->
            <div class="text-center py-32">
                <div class="mb-6">
                    <span class="text-8xl opacity-20">ðŸŽ¨</span>
                </div>
                <p class="text-xl mb-2" style="color: var(--text-black);">No items found</p>
                <p class="text-base mb-6" style="color: var(--dark-gray);">Try adjusting your filters</p>
                <a href="{% url 'marketplace:post_item' %}"
                   class="inline-block px-6 py-3 rounded-full btn-primary">
                    Post the First Item
                </a>
            </div>
            {% endif %}
        </main>
    </div>
</div>
{% endblock %}